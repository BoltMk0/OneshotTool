#N canvas 0 180 1252 730 10;
#X obj 155 25 loadbang;
#X obj -149 261 sel 0 1;
#X obj -149 328 pack f \$1;
#X msg -149 356 color \$1 -1;
#X msg -120 302 13;
#X msg -149 302 0;
#X obj -55 299 spigot;
#X obj -55 277 r globalmidi;
#X msg 22 360 0;
#X obj 280 86 r bgm\$1;
#N canvas 0 0 450 300 (subpatch) 0;
#X array bgm\$1L 302400 float 2;
#X coords 0 300 302400 299 200 140 0;
#X restore 527 39 graph;
#N canvas 0 0 450 300 (subpatch) 0;
#X array bgm\$1R 302400 float 2;
#X coords 0 300 302400 299 200 140 0;
#X restore 565 39 graph;
#X msg -55 319 \$2 \$1;
#X obj -55 339 route 0;
#X obj -16 360 t a b;
#X obj 420 713 *~;
#X obj 263 689 vline~;
#X msg 263 668 \$1 50;
#X obj 479 715 *~;
#X obj 299 800 throw~ master_out_L;
#X obj 358 779 throw~ master_out_R;
#X obj 101 119 cnv 15 78 140 empty bgm\$1backdrop bgm_pt1.wav 3 54
1 8 -225271 -1 0;
#X obj 105 199 tgl 15 0 bgm\$1midilearn bgm\$1midilearnr MidiLearn
17 7 1 10 -262144 -1 -1 0 1;
#X obj 105 179 bng 15 250 50 0 bgm\$1loadtrack bgm\$1loadtrackr LoadTrack
17 7 1 10 -262144 -1 -1;
#X obj 110 138 knob 25 25 0 127 0 0 bgm\$1volume bgm\$1volumer Volume
0 -8 1 8 -262144 -261234 -1 1200 1;
#X obj 146 138 knob 25 25 0 127 0 0 bgm\$1fade bgm\$1fader Fade 0 -8
1 8 -262144 -203904 -1 0 1;
#X obj 830 316 s midiout;
#X obj 830 275 pack f f;
#X msg 830 295 \$2 \$1;
#X msg 845 249 0;
#X obj 818 228 t f b;
#X text 858 227 <- clear previous pad before moving;
#X obj 148 102 cnv 15 30 15 empty bgm\$1midicnv _ 5 7 1 14 -262144
-1 0;
#X obj 384 66 r to_midi;
#X obj 384 87 route;
#N canvas 1323 420 543 300 handlemidiset 0;
#X obj 62 28 inlet;
#X obj 63 60 sel 0;
#X msg 63 93 0;
#X obj 157 115 i;
#X obj 106 92 t f f f b;
#X obj 106 116 outlet;
#X obj 182 278 s bgm\$1midicnv;
#X msg 182 228 label _\$1;
#X msg 94 156 symbol;
#X obj -96 201 s bgm\$1playcmd;
#X msg 157 136 \; to_midi \$1 midilink 0;
#X obj 48 202 s bgm\$1midilink;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 1 4 0;
#X connect 2 0 8 0;
#X connect 2 0 9 0;
#X connect 2 0 11 0;
#X connect 3 0 10 0;
#X connect 4 0 5 0;
#X connect 4 0 7 0;
#X connect 4 1 11 0;
#X connect 4 2 3 1;
#X connect 4 3 3 0;
#X connect 7 0 6 0;
#X connect 8 0 7 0;
#X restore 332 155 pd handlemidiset;
#N canvas 1095 198 809 598 playstate_handler 0;
#X obj 153 165 s bgm\$1backdrop;
#X msg 153 144 color 6 -1;
#X obj 153 79 r bgm\$1samplesize;
#X msg 153 123 bang;
#X msg 395 154 \$1 \$2;
#X obj 395 132 pack f f;
#X obj 420 365 +;
#X obj 405 391 +;
#X floatatom 482 328 5 0 0 0 - - -;
#X floatatom 481 369 5 0 0 0 - - -;
#X obj 394 316 * 65536;
#X obj 420 340 * 256;
#X obj 395 201 * 255;
#X obj 405 413 expr -1-$f1;
#X obj 394 262 expr 255 \; int(255-$f1*0.4) \; int(255-$f1*0.3) \;
;
#X msg 470 153 0 0;
#X obj 470 133 loadbang;
#X obj 395 180 line 0 100;
#X msg 321 148 1 1000;
#X obj 395 103 r bgm\$1playcmd;
#X obj 405 455 s bgm\$1playingcnv;
#X obj 496 455 s bgm\$1midicnv;
#X obj 440 45 r bgm\$1fadetime;
#X msg 494 432 color \$1 -1;
#X msg 405 434 color \$1 0;
#X obj 295 365 r bgm\$1playcmd;
#X obj 295 386 sel 0 1;
#X msg 314 427 label P;
#X msg 295 406 label;
#X obj 153 103 sel 0;
#X obj 543 128 sel 0;
#X obj 543 106 r bgm\$1playstate;
#X symbolatom 604 133 10 0 0 0 - - -;
#X floatatom 579 169 5 0 0 0 - - -;
#X connect 1 0 0 0;
#X connect 2 0 29 0;
#X connect 3 0 1 0;
#X connect 4 0 17 0;
#X connect 5 0 4 0;
#X connect 6 0 7 1;
#X connect 7 0 13 0;
#X connect 10 0 7 0;
#X connect 11 0 6 0;
#X connect 12 0 14 0;
#X connect 13 0 24 0;
#X connect 13 0 23 0;
#X connect 14 0 10 0;
#X connect 14 1 11 0;
#X connect 14 2 6 1;
#X connect 14 2 8 0;
#X connect 15 0 17 0;
#X connect 16 0 15 0;
#X connect 17 0 12 0;
#X connect 18 0 17 0;
#X connect 19 0 5 0;
#X connect 22 0 5 1;
#X connect 23 0 21 0;
#X connect 24 0 20 0;
#X connect 25 0 26 0;
#X connect 26 0 28 0;
#X connect 26 1 27 0;
#X connect 27 0 20 0;
#X connect 28 0 20 0;
#X connect 29 1 3 0;
#X connect 30 0 15 0;
#X connect 31 0 30 0;
#X connect 31 0 33 0;
#X restore 713 62 pd playstate_handler;
#X obj 435 680 *~;
#X obj 501 687 *~;
#X obj 710 524 vline~;
#X obj 754 394 r bgm\$1fade;
#X obj 710 502 pack f f;
#X obj 709 371 r bgm\$1playcmd;
#N canvas 1286 588 450 300 sampleloader 0;
#X obj 50 -5 inlet;
#X obj 50 14 route bang;
#X obj 50 35 openpanel;
#X obj 50 191 soundfiler;
#X msg 50 169 read -resize \$1 bgm\$2L bgm\$2R;
#X obj 50 87 pack s \$1;
#X obj 50 214 s bgm\$1samplesize;
#X obj 191 0 r bgm\$1loadtrack;
#X obj 295 81 splitfilename;
#X obj 69 141 s bgm\$1fullname;
#X obj 295 59 r bgm\$1fullname;
#X obj 370 102 s bgm\$1filename;
#X obj 292 175 r bgm\$1filename;
#X obj 292 216 s bgm\$1backdrop;
#X msg 292 195 label \$1;
#X msg 69 119 symbol \$1;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 1 5 0;
#X connect 2 0 5 0;
#X connect 3 0 6 0;
#X connect 4 0 3 0;
#X connect 5 0 4 0;
#X connect 5 0 15 0;
#X connect 7 0 2 0;
#X connect 8 1 11 0;
#X connect 10 0 8 0;
#X connect 12 0 14 0;
#X connect 14 0 13 0;
#X connect 15 0 9 0;
#X restore 476 151 pd sampleloader;
#X obj 326 350 s bgm\$1playstate;
#X msg 326 328 1;
#X obj -91 459 r globalmidi;
#X obj -91 501 route;
#X obj -91 576 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj -91 596 s bgm\$1playcmd;
#X obj -91 524 sel 0;
#X msg -64 547 bang;
#X obj 537 657 tabread4~ bgm\$1R;
#X obj 430 657 tabread4~ bgm\$1L;
#X obj 754 416 expr $f1*$f1;
#X obj 793 459 s bgm\$1fadetime;
#X obj 754 438 t b f f;
#X obj 702 552 *~;
#N canvas 612 393 949 414 saver 0;
#X obj 105 -7 r bgm\$1fullname;
#X obj 126 13 r bgm\$1volume;
#X obj 147 37 r bgm\$1fade;
#X obj 84 -49 inlet;
#X msg 84 -28 bang;
#X obj 240 360 textfile;
#X obj 82 365 print Saved;
#X obj 92 248 r sessiondir;
#X obj 48 269 pack f s;
#X msg 48 220 \$1;
#X obj 91 322 t s s;
#X msg 141 339 write \$1;
#X msg 48 291 symbol \$2/bgm\$1.conf;
#X obj 168 58 r bgm\$1midilink;
#X obj 189 79 r bgm\$1mono;
#X obj 85 153 t a a;
#X obj 85 132 pack \$1 s 63 0 0 0 0;
#X obj 209 101 r bgm\$1 loop;
#X msg 158 181 set name bgm\$1 \, add filename \$2 \, add volume \$3
\, add fade \$4 \, add midilink \$5 \, add mono \$6 \, add loop \$7
;
#X connect 0 0 16 1;
#X connect 1 0 16 2;
#X connect 2 0 16 3;
#X connect 3 0 4 0;
#X connect 4 0 16 0;
#X connect 7 0 8 1;
#X connect 8 0 12 0;
#X connect 9 0 8 0;
#X connect 10 0 6 0;
#X connect 10 1 11 0;
#X connect 11 0 5 0;
#X connect 12 0 10 0;
#X connect 13 0 16 4;
#X connect 14 0 16 5;
#X connect 15 0 9 0;
#X connect 15 1 18 0;
#X connect 16 0 15 0;
#X connect 17 0 16 6;
#X connect 18 0 5 0;
#X restore 280 132 pd saver;
#X obj 263 626 r bgm\$1volume;
#X obj 263 647 expr exp(4.16*$f1/127-2.08);
#X obj 385 178 s bgm\$1volumer;
#X obj 436 200 s bgm\$1fader;
#X obj 631 172 route ping;
#X obj 631 193 s ping;
#X obj 346 42 r global;
#N canvas 612 393 949 508 loader 0;
#X obj 72 82 pack \$1 s;
#X obj 123 60 r sessiondir;
#X obj 72 125 s loader;
#X msg 72 104 \$2/bgm\$1.conf;
#X msg 72 62 bang;
#X obj 72 42 inlet;
#X connect 0 0 3 0;
#X connect 1 0 0 1;
#X connect 3 0 2 0;
#X connect 4 0 0 0;
#X connect 5 0 4 0;
#X restore 803 109 pd loader;
#X obj 765 188 print [WN] Unrecognised bgm command;
#X obj 280 112 route save midilink;
#X msg -16 383 midilink \$2;
#X obj 470 108 print bgm\$1;
#X obj 451 66 r bgm\$1midilink;
#X obj -64 480 r bgm\$1midilink;
#X obj 105 219 tgl 15 0 bgm\$1mono bgm\$1monor Mono 17 7 1 10 -262144
-1 -1 0 1;
#X obj 523 200 s bgm\$1monor;
#X obj 429 738 *~ 0;
#X obj 491 739 *~ 0;
#X obj 512 715 r bgm\$1mono;
#X obj 163 242 bng 15 250 50 0 empty empty T 5 7 0 10 -262144 -1 -1
;
#X obj 137 102 cnv 15 15 15 empty bgm\$1playingcnv P 4 7 1 14 -262144
-262144 0;
#X obj 508 805 throw~ bgm_out_R;
#X obj 485 782 throw~ bgm_out_L;
#X obj 105 239 tgl 15 0 bgm\$1loop bgm\$1loopr Loop 17 7 1 10 -262144
-1 -1 1 1;
#X msg 217 58 volume 63.5 \, loop 1;
#X obj 385 132 route volume fade filename mono loop;
#X obj 563 177 s bgm\$1loopr;
#X obj 224 573 vline~;
#X obj 225 532 pack f f;
#X obj 225 507 i;
#X obj 240 470 r bgm\$1samplesize;
#X obj 270 491 r bgm\$1samplesize;
#X obj 225 315 t b b;
#X obj 252 394 spigot;
#X obj 285 371 r bgm\$1loop;
#X obj 252 349 delay;
#X obj 206 162 r bgm\$1playcmd;
#X obj 239 185 r bgm\$1samplesize;
#X obj 206 208 spigot;
#X obj 206 229 sel 0;
#X obj 298 250 r bgm\$1playstate;
#X obj 75 391 delay;
#X obj 68 368 r bgm\$1fadetime;
#X msg 75 349 stop;
#X obj 119 454 s bgm\$1playstate;
#X msg 119 433 0;
#X obj 253 290 spigot 1;
#X obj 279 328 / 44.1;
#X obj 279 307 r bgm\$1samplesize;
#X obj 270 511 / 44.1;
#X msg 224 552 0 0 \, \$1 \$2;
#X obj 794 483 r bgm\$1playstate;
#X obj 794 503 sel 0;
#X msg 794 523 0;
#X obj 297 410 r bgm\$1samplesize;
#X obj 252 431 spigot 1;
#X obj 139 403 spigot;
#X obj 142 316 r bgm\$1loop;
#X obj 1 513 r bgm\$1playstate;
#X msg 1 553 0;
#X obj 1 533 sel 0;
#X obj 220 263 spigot;
#X obj 253 222 r bgm\$1playstate;
#X obj 298 270 expr if($f1==0 \, 1 \, 0);
#X obj 23 599 print STATE;
#X obj 168 338 r bgm\$1playcmd;
#X obj 168 358 t b f;
#X obj 163 382 expr 1-$f1&&$f2;
#X connect 0 0 83 0;
#X connect 1 0 5 0;
#X connect 1 1 4 0;
#X connect 2 0 3 0;
#X connect 3 0 22 0;
#X connect 4 0 2 0;
#X connect 5 0 2 0;
#X connect 6 0 12 0;
#X connect 7 0 6 0;
#X connect 8 0 22 0;
#X connect 9 0 68 0;
#X connect 9 0 70 0;
#X connect 12 0 13 0;
#X connect 13 1 14 0;
#X connect 14 0 69 0;
#X connect 14 1 8 0;
#X connect 15 0 19 0;
#X connect 15 0 75 0;
#X connect 15 0 81 0;
#X connect 16 0 15 0;
#X connect 16 0 18 0;
#X connect 17 0 16 0;
#X connect 18 0 20 0;
#X connect 18 0 76 0;
#X connect 18 0 80 0;
#X connect 22 0 1 0;
#X connect 22 0 6 1;
#X connect 27 0 28 0;
#X connect 28 0 26 0;
#X connect 29 0 27 0;
#X connect 30 0 27 1;
#X connect 30 1 29 0;
#X connect 33 0 34 0;
#X connect 34 0 68 0;
#X connect 37 0 15 1;
#X connect 38 0 18 1;
#X connect 39 0 57 0;
#X connect 39 0 57 1;
#X connect 40 0 54 0;
#X connect 41 0 39 0;
#X connect 42 0 41 0;
#X connect 45 0 44 0;
#X connect 46 0 47 0;
#X connect 47 0 50 0;
#X connect 48 0 49 0;
#X connect 50 1 51 0;
#X connect 51 0 48 0;
#X connect 52 0 38 0;
#X connect 53 0 37 0;
#X connect 54 0 56 0;
#X connect 56 0 41 0;
#X connect 56 1 41 1;
#X connect 56 2 55 0;
#X connect 57 0 37 1;
#X connect 57 0 38 1;
#X connect 59 0 60 0;
#X connect 60 0 17 0;
#X connect 63 0 64 0;
#X connect 63 1 67 0;
#X connect 65 0 68 0;
#X connect 68 0 58 0;
#X connect 68 1 35 0;
#X connect 68 2 84 0;
#X connect 69 0 68 0;
#X connect 71 0 34 1;
#X connect 72 0 47 1;
#X connect 75 0 20 0;
#X connect 75 0 80 0;
#X connect 76 0 19 0;
#X connect 76 0 81 0;
#X connect 77 0 76 1;
#X connect 77 0 75 1;
#X connect 78 0 48 0;
#X connect 83 0 68 0;
#X connect 84 0 61 0;
#X connect 84 1 62 0;
#X connect 84 2 43 0;
#X connect 84 3 74 0;
#X connect 84 4 85 0;
#X connect 84 5 63 0;
#X connect 86 0 53 0;
#X connect 86 0 52 0;
#X connect 87 0 109 0;
#X connect 88 0 87 0;
#X connect 89 0 88 1;
#X connect 90 0 108 0;
#X connect 91 0 88 0;
#X connect 91 1 94 0;
#X connect 92 0 114 0;
#X connect 93 0 92 1;
#X connect 94 0 92 0;
#X connect 94 0 115 0;
#X connect 95 0 97 0;
#X connect 96 0 97 1;
#X connect 97 0 98 0;
#X connect 98 0 120 0;
#X connect 98 1 105 0;
#X connect 98 1 45 0;
#X connect 98 1 102 0;
#X connect 99 0 122 0;
#X connect 100 0 104 0;
#X connect 101 0 100 1;
#X connect 102 0 100 0;
#X connect 104 0 103 0;
#X connect 104 0 86 0;
#X connect 105 0 91 0;
#X connect 106 0 94 1;
#X connect 107 0 106 0;
#X connect 108 0 87 1;
#X connect 109 0 86 0;
#X connect 110 0 111 0;
#X connect 111 0 112 0;
#X connect 112 0 39 0;
#X connect 113 0 114 1;
#X connect 114 0 91 0;
#X connect 115 0 104 0;
#X connect 116 0 126 0;
#X connect 117 0 119 0;
#X connect 117 0 123 0;
#X connect 118 0 48 0;
#X connect 119 0 118 0;
#X connect 120 0 100 0;
#X connect 121 0 120 1;
#X connect 122 0 105 1;
#X connect 124 0 125 0;
#X connect 125 0 126 0;
#X connect 125 1 126 1;
#X connect 126 0 115 1;
#X coords 0 -1 1 1 80 160 1 100 100;
